<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi des actions</title>
<style>
  table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
  th { background-color: #f2f2f2; }
  input { width: 80px; }
</style>
</head>
<body>

<h1>Suivi des actions</h1>

<input type="text" id="symbol" placeholder="Symbole ex: AAPL">
<button onclick="addSymbol()">Ajouter</button>

<table id="watchlistTable">
  <thead>
    <tr>
      <th>Symbole</th>
      <th>Nom</th>
      <th>Cours (€/$)</th>
      <th>Nombre</th>
      <th>Dividendes</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API_KEY = 'BUJ9ONXMDU2BK43K'; // Ta clé AlphaVantage
let watchlist = JSON.parse(localStorage.getItem('watchlist')) || [];

// Met à jour le tableau
async function updateWatchlistTable() {
    const tbody = document.querySelector("#watchlistTable tbody");
    tbody.innerHTML = '';

    for (let i = 0; i < watchlist.length; i++) {
        const item = watchlist[i];
        let price = '-';
        let name = item.symbol || '-';

        if (item.symbol) {
            try {
                const response = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${item.symbol}&apikey=${API_KEY}`);
                const data = await response.json();
                if (data['Global Quote'] && data['Global Quote']['05. price']) {
                    price = parseFloat(data['Global Quote']['05. price']).toFixed(2);
                }
            } catch (e) {
                console.error(e);
            }
        }

        tbody.innerHTML += `
            <tr>
                <td>${item.symbol || '-'}</td>
                <td>${name}</td>
                <td>${price}</td>
                <td><input type="number" min="0" value="${item.quantity || 0}" onchange="updateQuantity(${i}, this.value)"></td>
                <td><input type="number" min="0" value="${item.dividends || 0}" onchange="updateDividends(${i}, this.value)"></td>
                <td><button onclick="removeSymbolByIndex(${i})">Supprimer</button></td>
            </tr>
        `;
    }
}

// Ajouter un symbole
function addSymbol() {
    const symbolInput = document.getElementById('symbol');
    const symbol = symbolInput.value.toUpperCase().trim();
    if (!symbol) return alert("Symbole invalide.");
    watchlist.push({ symbol, quantity: 0, dividends: 0 });
    localStorage.setItem('watchlist', JSON.stringify(watchlist));
    symbolInput.value = '';
    updateWatchlistTable();
}

// Supprimer par index (fonctionne même si symbole undefined)
function removeSymbolByIndex(index) {
    watchlist.splice(index, 1);
    localStorage.setItem('watchlist', JSON.stringify(watchlist));
    updateWatchlistTable();
}

// Mettre à jour la quantité
function updateQuantity(index, value) {
    watchlist[index].quantity = parseFloat(value) || 0;
    localStorage.setItem('watchlist', JSON.stringify(watchlist));
}

// Mettre à jour les dividendes
function updateDividends(index, value) {
    watchlist[index].dividends = parseFloat(value) || 0;
    localStorage.setItem('watchlist', JSON.stringify(watchlist));
}

// Initialisation
updateWatchlistTable();
</script>

</body>
</html>
