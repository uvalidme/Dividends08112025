<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi Boursier</title>
<style>
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  input { width: 80px; }
  button { padding: 4px 8px; }
</style>
</head>
<body>

<h1>Suivi de mes actions</h1>

<input type="text" id="symbolInput" placeholder="Ex: TTE.PA ou AAPL">
<button onclick="addStock()">Ajouter</button>

<table id="stocksTable">
  <thead>
    <tr>
      <th>Symbol</th>
      <th>Nom</th>
      <th>Cours (€/$)</th>
      <th>Actions détenues</th>
      <th>Dividendes</th>
      <th>Supprimer</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const PROXY_URL = "https://finnhub-proxy-wq5s.onrender.com/stooq";

// Liste des noms complets pour les principales actions
const STOCK_NAMES = {
  "TTE.PA": "TotalEnergies",
  "MC.PA": "LVMH",
  "AIR.PA": "Airbus",
  "AAPL": "Apple",
  "MSFT": "Microsoft",
  "GOOGL": "Alphabet"
};

async function getStockInfo(symbol) {
  try {
    const fixedSymbol = symbol.trim().toUpperCase();
    const url = `${PROXY_URL}?symbol=${fixedSymbol}`;
    const response = await fetch(url);
    const text = await response.text();

    const lines = text.trim().split("\n");
    if (lines.length < 2) return null;

    const headers = lines[0].split(",");
    const values = lines[1].split(",");

    const stock = {};
    headers.forEach((h, i) => stock[h.toLowerCase()] = values[i]);

    return {
      symbol: stock.symbol.toUpperCase(),
      name: STOCK_NAMES[fixedSymbol] || stock.symbol.toUpperCase(),
      price: parseFloat(stock.close)
    };
  } catch (e) {
    console.error("Erreur récupération Stooq :", e);
    return null;
  }
}

async function addStock() {
  const input = document.getElementById("symbolInput");
  const symbol = input.value.trim();
  if (!symbol) return alert("Veuillez entrer un symbole.");
  
  const stock = await getStockInfo(symbol);
  if (!stock) return alert("Données introuvables pour ce symbole.");

  const tbody = document.querySelector("#stocksTable tbody");
  
  const row = document.createElement("tr");

  row.innerHTML = `
    <td>${stock.symbol}</td>
    <td>${stock.name}</td>
    <td>${stock.price.toFixed(2)}</td>
    <td><input type="number" value="0" min="0" class="shares"></td>
    <td><input type="number" value="0" min="0" step="0.01" class="dividends"></td>
    <td><button onclick="deleteRow(this)">Supprimer</button></td>
  `;

  tbody.appendChild(row);
  input.value = "";
}

function deleteRow(button) {
  const row = button.closest("tr");
  row.remove();
}
</script>
</body>
</html>

